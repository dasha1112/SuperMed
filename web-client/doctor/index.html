<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperMed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
        }

        .container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .sidebar {
            width: 300px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #3498db;
        }

        .nav-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: none;
            border: none;
            color: white;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-button:hover, .nav-button.active {
            background-color: #34495e;
        }

        .messages-section {
            margin-top: 20px;
        }

        .messages-section h3 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }

        .message-item {
            background-color: #34495e;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .message-item:hover {
            background-color: #3d566e;
        }

        .message-item.active {
            background-color: #3498db;
        }

        .patient-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .patient-message {
            font-size: 14px;
            color: #bdc3c7;
            margin-bottom: 5px;
        }

        .appointment-date {
            font-size: 12px;
            color: #bdc3c7;
        }

        /* Стили для расписания */
        .schedule-view {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px;
        }

        .schedule-day {
            margin-bottom: 25px;
        }

        .day-header {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .appointment-slot {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            position: relative;
        }

        .appointment-time {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .appointment-patient {
            color: #7f8c8d;
        }

        .complete-button {
            position: absolute;
            right: 15px;
            top: 15px;
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .complete-button:hover {
            background-color: #219a52;
        }

        .completed {
            border-left-color: #27ae60;
            background-color: #f0f9f0;
        }

        .complete-button.completed-btn {
            background-color: #95a5a6;
        }

        .complete-button.completed-btn:hover {
            background-color: #7f8c8d;
        }

        /* Стили для чата */
        .chat-view {
            display: none;
            flex-direction: column;
            height: 100vh;
            background: white;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .patient-info {
            display: flex;
            align-items: center;
        }

        .patient-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            max-width: 70%;
        }

        .message.patient {
            margin-right: auto;
        }

        .message.doctor {
            margin-left: auto;
        }

        .message-content {
            padding: 12px 15px;
            border-radius: 18px;
        }

        .message.patient .message-content {
            background-color: #e8f4f8;
            border-top-left-radius: 5px;
        }

        .message.doctor .message-content {
            background-color: #3498db;
            color: white;
            border-top-right-radius: 5px;
        }

        .message-time {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #eaeaea;
            display: flex;
            background: white;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
        }

        .chat-input button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            cursor: pointer;
        }

        .no-chat-selected {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #7f8c8d;
            font-size: 18px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="sidebar">
        <div class="logo">SuperMed</div>
        <button class="nav-button active" data-view="schedule">Мое расписание</button>
        <button class="nav-button" data-view="messages">Сообщения</button>

        <div class="messages-section">
            <h3>Сообщения</h3>
            <div class="message-item active" data-patient="a.petrov">
                <div class="patient-name">a.petrov</div>
                <div class="patient-message">Здравствуйте, у меня вопрос по рецепту...</div>
                <div class="appointment-date">Запись на 15 мая, 10:00</div>
            </div>
            <div class="message-item" data-patient="m.sidorova">
                <div class="patient-name">m.sidorova</div>
                <div class="patient-message">Спасибо за консультацию!</div>
                <div class="appointment-date">Запись на 16 мая, 14:30</div>
            </div>
            <div class="message-item" data-patient="d.kozlov">
                <div class="patient-name">d.kozlov</div>
                <div class="patient-message">Когда можно записаться на прием?</div>
                <div class="appointment-date">Запись на 17 мая, 11:15</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <!-- Вид расписания -->
        <div id="scheduleView" class="schedule-view">
            <h2>Мое расписание</h2>
            <div class="schedule-day">
                <div class="day-header">Понедельник, 15 мая</div>
                <div class="appointment-slot" data-appointment="1">
                    <div class="appointment-time">10:00 - 10:30</div>
                    <div class="appointment-patient">a.petrov - Консультация</div>
                    <button class="complete-button">Завершить</button>
                </div>
                <div class="appointment-slot" data-appointment="2">
                    <div class="appointment-time">11:15 - 11:45</div>
                    <div class="appointment-patient">d.kozlov - Первичный прием</div>
                    <button class="complete-button">Завершить</button>
                </div>
                <div class="appointment-slot" data-appointment="3">
                    <div class="appointment-time">14:00 - 14:30</div>
                    <div class="appointment-patient">e.ivanova - Повторный прием</div>
                    <button class="complete-button">Завершить</button>
                </div>
            </div>

            <div class="schedule-day">
                <div class="day-header">Вторник, 16 мая</div>
                <div class="appointment-slot" data-appointment="4">
                    <div class="appointment-time">09:30 - 10:00</div>
                    <div class="appointment-patient">s.popov - Консультация</div>
                    <button class="complete-button">Завершить</button>
                </div>
                <div class="appointment-slot" data-appointment="5">
                    <div class="appointment-time">14:30 - 15:00</div>
                    <div class="appointment-patient">m.sidorova - Повторный прием</div>
                    <button class="complete-button">Завершить</button>
                </div>
            </div>
        </div>

        <!-- Вид сообщений -->
        <div id="messagesView" class="chat-view">
            <div class="no-chat-selected">
                Выберите диалог для просмотра сообщений
            </div>

            <!-- Диалог с a.petrov -->
            <div class="chat-dialog" id="chat-a.petrov" style="display: none;">
                <div class="chat-header">
                    <div class="patient-info">
                        <div class="patient-avatar">AP</div>
                        <div>
                            <div class="patient-name">a.petrov</div>
                            <div class="patient-status">В сети</div>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" data-patient="a.petrov">
                    <div class="message patient">
                        <div class="message-content">
                            Здравствуйте, доктор! У меня вопрос по рецепту, который вы выписали в прошлый раз.
                        </div>
                        <div class="message-time">10:15</div>
                    </div>

                    <div class="message doctor">
                        <div class="message-content">
                            Здравствуйте, Алексей. Какой именно у вас вопрос?
                        </div>
                        <div class="message-time">10:20</div>
                    </div>

                    <div class="message patient">
                        <div class="message-content">
                            Можно ли заменить препарат на аналог? В аптеке не было того, что вы прописали.
                        </div>
                        <div class="message-time">10:22</div>
                    </div>
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Введите сообщение..." data-patient="a.petrov">
                    <button onclick="sendMessage('a.petrov')">➤</button>
                </div>
            </div>

            <!-- Диалог с m.sidorova -->
            <div class="chat-dialog" id="chat-m.sidorova" style="display: none;">
                <div class="chat-header">
                    <div class="patient-info">
                        <div class="patient-avatar">MS</div>
                        <div>
                            <div class="patient-name">m.sidorova</div>
                            <div class="patient-status">Был(а) недавно</div>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" data-patient="m.sidorova">
                    <div class="message patient">
                        <div class="message-content">
                            Добрый день! Хотела поблагодарить за консультацию на прошлой неделе.
                        </div>
                        <div class="message-time">09:30</div>
                    </div>

                    <div class="message doctor">
                        <div class="message-content">
                            Здравствуйте, Мария! Рад был помочь. Как ваше самочувствие?
                        </div>
                        <div class="message-time">09:35</div>
                    </div>

                    <div class="message patient">
                        <div class="message-content">
                            Стало значительно лучше после смены препарата. Спасибо!
                        </div>
                        <div class="message-time">09:40</div>
                    </div>
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Введите сообщение..." data-patient="m.sidorova">
                    <button onclick="sendMessage('m.sidorova')">➤</button>
                </div>
            </div>

            <!-- Диалог с d.kozlov -->
            <div class="chat-dialog" id="chat-d.kozlov" style="display: none;">
                <div class="chat-header">
                    <div class="patient-info">
                        <div class="patient-avatar">DK</div>
                        <div>
                            <div class="patient-name">d.kozlov</div>
                            <div class="patient-status">В сети</div>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" data-patient="d.kozlov">
                    <div class="message patient">
                        <div class="message-content">
                            Доктор, когда можно записаться на прием?
                        </div>
                        <div class="message-time">14:15</div>
                    </div>

                    <div class="message doctor">
                        <div class="message-content">
                            Здравствуйте, Дмитрий! У меня есть свободные окна в среду и пятницу.
                        </div>
                        <div class="message-time">14:20</div>
                    </div>

                    <div class="message patient">
                        <div class="message-content">
                            Отлично, записаться на среду, пожалуйста.
                        </div>
                        <div class="message-time">14:25</div>
                    </div>
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Введите сообщение..." data-patient="d.kozlov">
                    <button onclick="sendMessage('d.kozlov')">➤</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Имитация базы данных в localStorage
    function initializeDatabase() {
        if (!localStorage.getItem('appointmentsStatus')) {
            const appointmentsStatus = {
                '1': false, // appointmentId: completed
                '2': false,
                '3': false,
                '4': false,
                '5': false
            };
            localStorage.setItem('appointmentsStatus', JSON.stringify(appointmentsStatus));
        }

        if (!localStorage.getItem('chatMessages')) {
            const chatMessages = {
                'a.petrov': [
                    { sender: 'patient', text: 'Здравствуйте, доктор! У меня вопрос по рецепту, который вы выписали в прошлый раз.', time: '10:15' },
                    { sender: 'doctor', text: 'Здравствуйте, Алексей. Какой именно у вас вопрос?', time: '10:20' },
                    { sender: 'patient', text: 'Можно ли заменить препарат на аналог? В аптеке не было того, что вы прописали.', time: '10:22' }
                ],
                'm.sidorova': [
                    { sender: 'patient', text: 'Добрый день! Хотела поблагодарить за консультацию на прошлой неделе.', time: '09:30' },
                    { sender: 'doctor', text: 'Здравствуйте, Мария! Рад был помочь. Как ваше самочувствие?', time: '09:35' },
                    { sender: 'patient', text: 'Стало значительно лучше после смены препарата. Спасибо!', time: '09:40' }
                ],
                'd.kozlov': [
                    { sender: 'patient', text: 'Доктор, когда можно записаться на прием?', time: '14:15' },
                    { sender: 'doctor', text: 'Здравствуйте, Дмитрий! У меня есть свободные окна в среду и пятницу.', time: '14:20' },
                    { sender: 'patient', text: 'Отлично, записаться на среду, пожалуйста.', time: '14:25' }
                ]
            };
            localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
        }
    }

    // Функция отправки сообщения
    function sendMessage(patientId) {
        const input = document.querySelector(`input[data-patient="${patientId}"]`);
        const messageText = input.value.trim();

        if (messageText) {
            // Сохраняем сообщение в "базу данных"
            const chatMessages = JSON.parse(localStorage.getItem('chatMessages'));
            const currentTime = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

            chatMessages[patientId].push({
                sender: 'doctor',
                text: messageText,
                time: currentTime
            });

            localStorage.setItem('chatMessages', JSON.stringify(chatMessages));

            // Обновляем отображение чата
            updateChatDisplay(patientId);

            // Очищаем поле ввода
            input.value = '';

            // В реальном приложении здесь был бы AJAX-запрос к серверу
            console.log(`Сообщение отправлено пациенту ${patientId}: ${messageText}`);
        }
    }

    // Функция обновления отображения чата
    function updateChatDisplay(patientId) {
        const chatMessages = JSON.parse(localStorage.getItem('chatMessages'));
        const messagesContainer = document.querySelector(`.chat-messages[data-patient="${patientId}"]`);

        if (messagesContainer) {
            messagesContainer.innerHTML = '';

            chatMessages[patientId].forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', msg.sender);

                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                messageContent.textContent = msg.text;

                const messageTime = document.createElement('div');
                messageTime.classList.add('message-time');
                messageTime.textContent = msg.time;

                messageElement.appendChild(messageContent);
                messageElement.appendChild(messageTime);

                messagesContainer.appendChild(messageElement);
            });

            // Прокручиваем вниз
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    }

    // Функция завершения консультации
    function completeAppointment(appointmentId, button) {
        const appointmentsStatus = JSON.parse(localStorage.getItem('appointmentsStatus'));

        if (button.textContent === 'Завершить') {
            appointmentsStatus[appointmentId] = true;
            button.textContent = 'Завершено';
            button.classList.add('completed-btn');
            button.parentElement.classList.add('completed');
        } else {
            appointmentsStatus[appointmentId] = false;
            button.textContent = 'Завершить';
            button.classList.remove('completed-btn');
            button.parentElement.classList.remove('completed');
        }

        localStorage.setItem('appointmentsStatus', JSON.stringify(appointmentsStatus));

        // В реальном приложении здесь был бы AJAX-запрос к серверу
        console.log(`Статус консультации ${appointmentId} изменен на: ${appointmentsStatus[appointmentId]}`);
    }

    // Функция загрузки статуса консультаций
    function loadAppointmentsStatus() {
        const appointmentsStatus = JSON.parse(localStorage.getItem('appointmentsStatus'));

        Object.keys(appointmentsStatus).forEach(appointmentId => {
            const appointmentSlot = document.querySelector(`[data-appointment="${appointmentId}"]`);
            const button = appointmentSlot?.querySelector('.complete-button');

            if (appointmentSlot && button) {
                if (appointmentsStatus[appointmentId]) {
                    appointmentSlot.classList.add('completed');
                    button.textContent = 'Завершено';
                    button.classList.add('completed-btn');
                } else {
                    appointmentSlot.classList.remove('completed');
                    button.textContent = 'Завершить';
                    button.classList.remove('completed-btn');
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Инициализируем базу данных
        initializeDatabase();

        const navButtons = document.querySelectorAll('.nav-button');
        const scheduleView = document.getElementById('scheduleView');
        const messagesView = document.getElementById('messagesView');
        const messageItems = document.querySelectorAll('.message-item');
        const noChatSelected = document.querySelector('.no-chat-selected');
        const chatDialogs = document.querySelectorAll('.chat-dialog');
        const completeButtons = document.querySelectorAll('.complete-button');

        // Загружаем статус консультаций
        loadAppointmentsStatus();

        // Переключение между расписанием и сообщениями
        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                const view = this.getAttribute('data-view');

                // Обновляем активные кнопки
                navButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // Показываем соответствующий вид
                if (view === 'schedule') {
                    scheduleView.style.display = 'block';
                    messagesView.style.display = 'none';
                } else if (view === 'messages') {
                    scheduleView.style.display = 'none';
                    messagesView.style.display = 'flex';

                    // Показываем выбранный диалог или сообщение о выборе
                    const activeMessage = document.querySelector('.message-item.active');
                    if (activeMessage) {
                        showChat(activeMessage.getAttribute('data-patient'));
                    } else {
                        showNoChat();
                    }
                }
            });
        });

        // Переключение между пациентами в сообщениях
        messageItems.forEach(item => {
            item.addEventListener('click', function() {
                // Обновляем активные элементы
                messageItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                // Показываем соответствующий чат
                const patientId = this.getAttribute('data-patient');
                showChat(patientId);
            });
        });

        // Обработчик кнопок "Завершить"/"Завершено"
        completeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const appointmentSlot = this.parentElement;
                const appointmentId = appointmentSlot.getAttribute('data-appointment');
                completeAppointment(appointmentId, this);
            });
        });

        // Обработчик Enter в поле ввода сообщения
        document.querySelectorAll('.chat-input input').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const patientId = this.getAttribute('data-patient');
                    sendMessage(patientId);
                }
            });
        });

        function showChat(patientId) {
            // Скрываем все диалоги и сообщение о выборе
            chatDialogs.forEach(dialog => dialog.style.display = 'none');
            noChatSelected.style.display = 'none';

            // Показываем выбранный диалог
            const selectedChat = document.getElementById(`chat-${patientId}`);
            if (selectedChat) {
                selectedChat.style.display = 'flex';
                selectedChat.style.flexDirection = 'column';
                selectedChat.style.height = '100%';

                // Обновляем отображение чата
                updateChatDisplay(patientId);
            }
        }

        function showNoChat() {
            // Скрываем все диалоги
            chatDialogs.forEach(dialog => dialog.style.display = 'none');
            // Показываем сообщение о выборе
            noChatSelected.style.display = 'flex';
        }

        // По умолчанию показываем расписание
        scheduleView.style.display = 'block';
        messagesView.style.display = 'none';
    });
</script>
</body>
</html>